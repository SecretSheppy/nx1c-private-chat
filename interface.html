<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="resources/css/style.css">
    <script type="text/javascript" src="node_modules/socket.io/client-dist/socket.io.js"></script>
    <script type="text/javascript" src="resources/js/client.js"></script>
    <script type="text/javascript" src="resources/js/encrypter.js"></script>
    <script type="text/javascript" src="resources/js/interface.js"></script>
    <script type="text/javascript" src="resources/jquery/jquery-3.7.0.min.js"></script>
    <script type="text/javascript">
        const fileTools = require('./resources/modules/fileTools');
        const encrypter = require('./resources/modules/encrypter/');
        const encKey = require('./resources/modules/encrypter/key');
        const client = new ClientEnvironment();
    </script>
    <title>NX1C Private Chat</title>
</head>
<body>
<div class="title-bar-wrapper">
    <div class="title-bar">
        <div class="draggable-area">
            <img src="resources/images/logo.png">
            <p name="title-text-localisation">NX1C Private Chat</p>
        </div>
        <button class="button" onclick="$('#key-modifier').fadeToggle(200);" style="display: none;" id="key-button">
            <img src="resources/interface/key.png">
        </button>
        <button class="button" onclick="nw.Window.get().minimize()">
            <img src="resources/interface/line.png">
        </button>
        <button class="button quit" onclick="nw.Window.get().close()">
            <img src="resources/interface/cross.png">
        </button>
    </div>
</div>
<div id="alert" class="alert" style="display: none;">
    <p id="alert-text" name="alert-text-localisation">Waiting for connection...</p>
</div>
<div class="thin" id="key-modifier" style="display: none">
    <div class="inline-content-wrapper">
        <h4 name="private-key-prompt-localisation">Private Key:</h4>
        <input name="private-key-field-localisation" id="private-key-field" type="text" placeholder="Enter private key" autocomplete="off" required />
        <input name="private-key-submit-localisation" type="submit" value="Update" onclick="client.updatePrivateKey();">
    </div>
</div>
<!--Login Screen-->
<div id="recent-connections">
    <div class="recent-connections">
        <h4 name="previous-connections-prompt-localisation">Previous Connections</h4>
        <div class="connections" id="connections"></div>
        <script>
            client.loadRecentConnections();
        </script>
    </div>
</div>
<div class="login-wrapper" id="login">
    <div class="login">
        <img src="resources/images/pc_logo.png">
        <div class="label-wrapper">
            <label for="username" name="server-host-prompt-localisation">Server Host</label>
        </div>
        <div class="server-host-wrapper">
            <select id="protocol">
                <option value="http://">http://</option>
                <option value="https://">https://</option>
            </select>
            <input id="server-host" type="text" placeholder="www.example.com" autocomplete="off" required />
        </div>
        <div class="label-wrapper">
            <label for="username" name="username-prompt-localisation">Username</label>
        </div>
        <input id="username" type="text" placeholder="Enter your username" name="username-prompt-field-localisation" autocomplete="off" required />
        <p name="private-key-information-prompt" style="margin-top: 20px">In order to read and send messages in the server you will need to add the servers private encryption key into the privatekeys.json file</p>
        <div class="button-wrapper">
            <input name="quit-button-localisation" type="reset" value="Quit" class="spacing" onclick="nw.Window.get().close();" />
            <input name="connect-button-localisation" type="submit" value="Connect" onclick="client.connectToServer();" />
        </div>
    </div>
</div>
<div class="login-wrapper" id="password" style="display: none;">
    <div class="login">
        <img src="resources/images/pc_logo.png">
        <div class="label-wrapper">
            <label for="password-text" name="server-password-prompt-localisation">Server Password</label>
        </div>
        <input id="password-text" type="password" placeholder="Enter server password" name="server-password-prompt-field-localisation" autocomplete="off" required />
        <div class="button-wrapper">
            <input name="quit-button-localisation" type="reset" value="Quit" class="spacing" onclick="nw.Window.get().close();" />
            <input name="connect-button-localisation" type="submit" value="Connect" onclick="client.submitServerPassword();" />
        </div>
    </div>
</div>
<div class="login-wrapper" id="kicked" style="display: none;">
    <div class="login">
        <img src="resources/images/pc_logo.png">
        <p name="kicked-notification-localisation">You have been kicked from the server queue</p>
        <p id="kick-reason"></p>
        <div class="button-wrapper">
            <input name="quit-button-localisation" type="reset" value="Quit" class="spacing" onclick="nw.Window.get().close();" />
            <input name="home-button-localisation" type="submit" value="Home" onclick="client.showHome();" />
        </div>
    </div>
</div>
<!--Chat Screen-->
<div id="chat" class="chat" style="display: none;">
    <div class="chat-wrapper" id="message-list">
    </div>
    <div class="chat-content-info">
        <p id="message-characters" name="message-character-localisation">Message Characters: 0/500</p>
    </div>
    <div class="chat-box">
        <input name="message-field-localisation" id="message-box" type="text" placeholder="Enter message">
        <input name="send-button-localisation" type="submit" value="Send" onclick="client.sendMessage()">
    </div>
</div>
</body>
<script type="text/javascript">
    let messageBoxElement = document.getElementById("message-box");
    let messageCharactersElement = document.getElementById("message-characters");
    messageBoxElement.addEventListener("keydown", (event) => {
        messageCharactersElement.innerText = "Message Characters: " + messageBoxElement.value.length + "/500";
        if (messageBoxElement.value.length > 500) {
            messageCharactersElement.style.color = "red";
        } else {
            messageCharactersElement.style.color = "var(--footer-bgcolor)";
        }
        if (event.key === "Enter") {
            client.sendMessage();
        }
    });
</script>
</html>